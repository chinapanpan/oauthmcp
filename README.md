# OAuth MCP Demo

ä¸€ä¸ªå®Œæ•´çš„ OAuth 2.0 + MCP (Model Context Protocol) æ¼”ç¤ºé¡¹ç›®ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ OAuth è®¤è¯ä¿æŠ¤ MCP æœåŠ¡å™¨ã€‚

## ðŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨æœåŠ¡å™¨
python start_servers.py

# 3. æµ‹è¯•ï¼ˆåœ¨æ–°ç»ˆç«¯ï¼‰
python test_oauth_flow.py
```

## ðŸ“¡ æœåŠ¡åœ°å€

- **OAuth æœåŠ¡å™¨**: http://127.0.0.1:5000
- **MCP æœåŠ¡å™¨**: http://127.0.0.1:5001

## ðŸ”„ OAuth æ—¶åºå›¾

### å®Œæ•´æŽˆæƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â”‚          â”‚   MCP   â”‚          â”‚  OAuth  â”‚          â”‚Resource â”‚
â”‚         â”‚          â”‚  Server â”‚          â”‚  Server â”‚          â”‚   API   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  1. Initialize     â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  2. Return OAuth   â”‚                    â”‚                    â”‚
     â”‚     Metadata       â”‚                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  3. Register Clientâ”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  4. Client ID/Secret                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  5. Authorization Request               â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  6. Authorization Code                  â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  7. Token Request  â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  8. Access Token   â”‚                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  9. Call MCP Tool (with token)          â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚  10. Access API (with token)            â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚  11. Verify Token  â”‚                    â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚  12. Return Data   â”‚                    â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  13. Return Result â”‚                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
```

### å…³é”®æ­¥éª¤è¯´æ˜Ž

1. **åˆå§‹åŒ–**: å®¢æˆ·ç«¯è¿žæŽ¥ MCP æœåŠ¡å™¨ï¼ŒèŽ·å– OAuth é…ç½®ä¿¡æ¯
2. **è¿”å›žå…ƒæ•°æ®**: MCP æœåŠ¡å™¨è¿”å›ž OAuth ç«¯ç‚¹åœ°å€å’Œæ”¯æŒçš„ scopes
3. **å®¢æˆ·ç«¯æ³¨å†Œ**: å®¢æˆ·ç«¯å‘ OAuth æœåŠ¡å™¨åŠ¨æ€æ³¨å†Œï¼ŒèŽ·å–å‡­è¯
4. **æŽˆæƒè¯·æ±‚**: å®¢æˆ·ç«¯è¯·æ±‚ç”¨æˆ·æŽˆæƒï¼ˆdemo æ¨¡å¼è‡ªåŠ¨æ‰¹å‡†ï¼‰
5. **æŽˆæƒç **: OAuth æœåŠ¡å™¨è¿”å›žæŽˆæƒç 
6. **ä»¤ç‰Œäº¤æ¢**: ä½¿ç”¨æŽˆæƒç æ¢å–è®¿é—®ä»¤ç‰Œ
7. **è°ƒç”¨å·¥å…·**: å®¢æˆ·ç«¯ä½¿ç”¨ä»¤ç‰Œè°ƒç”¨ MCP å·¥å…·
8. **è®¿é—® API**: MCP æœåŠ¡å™¨ä½¿ç”¨ä»¤ç‰Œè®¿é—®å—ä¿æŠ¤çš„èµ„æº
9. **éªŒè¯ä»¤ç‰Œ**: èµ„æºæœåŠ¡å™¨éªŒè¯ JWT ä»¤ç‰Œ
10. **è¿”å›žæ•°æ®**: è¿”å›žå—ä¿æŠ¤çš„èµ„æºæ•°æ®

## âš™ï¸ é…ç½®è¯´æ˜Ž

### config.py é…ç½®é¡¹

```python
# OAuth æœåŠ¡å™¨é…ç½®
OAUTH_SERVER_HOST = "127.0.0.1"      # OAuth æœåŠ¡å™¨åœ°å€
OAUTH_SERVER_PORT = 5000              # OAuth æœåŠ¡å™¨ç«¯å£
OAUTH_ISSUER = "http://127.0.0.1:5000"  # OAuth é¢å‘è€… URL

# MCP æœåŠ¡å™¨é…ç½®
MCP_SERVER_HOST = "127.0.0.1"        # MCP æœåŠ¡å™¨åœ°å€
MCP_SERVER_PORT = 5001                # MCP æœåŠ¡å™¨ç«¯å£
MCP_SERVER_URL = "http://127.0.0.1:5001"  # MCP æœåŠ¡å™¨å®Œæ•´ URL

# å®‰å…¨é…ç½®
SECRET_KEY = "dev-secret-key-change-in-production"  # JWT ç­¾åå¯†é’¥ï¼ˆç”Ÿäº§çŽ¯å¢ƒå¿…é¡»ä¿®æ”¹ï¼‰

# Demo æ¨¡å¼é…ç½®
DEMO_MODE = True                      # æ˜¯å¦å¯ç”¨æ¼”ç¤ºæ¨¡å¼
DEMO_AUTHORIZATION_CODE = "DEMO_AUTH_CODE_12345"  # æ¼”ç¤ºç”¨å›ºå®šæŽˆæƒç 
DEMO_CLIENT_ID = "demo_client"        # æ¼”ç¤ºç”¨å›ºå®šå®¢æˆ·ç«¯ ID
DEMO_CLIENT_SECRET = "demo_secret"    # æ¼”ç¤ºç”¨å›ºå®šå®¢æˆ·ç«¯å¯†é’¥

# OAuth ç«¯ç‚¹ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
AUTHORIZATION_ENDPOINT = "http://127.0.0.1:5000/oauth/authorize"
TOKEN_ENDPOINT = "http://127.0.0.1:5000/oauth/token"
REGISTRATION_ENDPOINT = "http://127.0.0.1:5000/oauth/register"
JWKS_URI = "http://127.0.0.1:5000/.well-known/jwks.json"
```

### çŽ¯å¢ƒå˜é‡é…ç½®ï¼ˆå¯é€‰ï¼‰

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# æœåŠ¡å™¨é…ç½®
OAUTH_SERVER_HOST=127.0.0.1
OAUTH_SERVER_PORT=5000
MCP_SERVER_HOST=127.0.0.1
MCP_SERVER_PORT=5001

# å®‰å…¨é…ç½®
SECRET_KEY=your-secret-key-here

# Demo æ¨¡å¼
DEMO_MODE=true
```

## ðŸ”§ MCP å®¢æˆ·ç«¯é…ç½®

### Cursor é…ç½®

åœ¨ Cursor çš„ MCP è®¾ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼ˆé€šå¸¸åœ¨ `~/.cursor/mcp.json`ï¼‰ï¼š

```json
{
  "mcpServers": {
    "oauth-demo": {
      "url": "http://127.0.0.1:5001/mcp/v1",
      "transport": "sse"
    }
  }
}
```

**ä½¿ç”¨æ–¹å¼**ï¼š
1. é‡å¯ Cursor
2. åœ¨å¯¹è¯ä¸­ç›´æŽ¥ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼š
   ```
   è¯·å¸®æˆ‘è®¤è¯åˆ° OAuth æœåŠ¡å™¨
   èŽ·å–æ•°æ®åˆ—è¡¨
   åˆ›å»ºä¸€ä¸ªåä¸º "Test" å€¼ä¸º 100 çš„é¡¹ç›®
   ```

### Amazon Q CLI é…ç½®

```json
{
  "mcp": {
    "servers": {
      "oauth-demo": {
        "url": "http://127.0.0.1:5001/mcp/v1",
        "transport": "http"
      }
    }
  }
}
```

### MCP Inspector é…ç½®

1. **MCP æœåŠ¡å™¨ URL**: `http://127.0.0.1:5001/mcp/v1`
2. **ä¼ è¾“æ–¹å¼**: SSE æˆ– HTTP
3. OAuth è®¤è¯ä¼šè‡ªåŠ¨è¿›è¡Œ

## ðŸ› ï¸ MCP å·¥å…·åˆ—è¡¨

| å·¥å…·åç§° | æè¿° | æ‰€éœ€æƒé™ | å‚æ•° |
|---------|------|---------|------|
| `oauth_authenticate` | OAuth è®¤è¯ | æ—  | æ—  |
| `get_user_profile` | èŽ·å–ç”¨æˆ·èµ„æ–™ | read | æ—  |
| `get_data` | èŽ·å–æ•°æ®åˆ—è¡¨ | read | æ—  |
| `create_data` | åˆ›å»ºæ•°æ® | write | name, value |
| `update_data` | æ›´æ–°æ•°æ® | write | item_id, name, value |
| `delete_data` | åˆ é™¤æ•°æ® | write | item_id |

## ðŸ“‹ API ç«¯ç‚¹

### OAuth æœåŠ¡å™¨ (Port 5000)

| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜Ž |
|-----|------|------|
| `/oauth/register` | POST | åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ |
| `/oauth/authorize` | GET | æŽˆæƒç«¯ç‚¹ |
| `/oauth/token` | POST | ä»¤ç‰Œç«¯ç‚¹ |
| `/.well-known/oauth-authorization-server` | GET | OAuth å…ƒæ•°æ® |
| `/.well-known/jwks.json` | GET | å…¬é’¥é›† |
| `/health` | GET | å¥åº·æ£€æŸ¥ |

### MCP æœåŠ¡å™¨ (Port 5001)

**MCP åè®®ç«¯ç‚¹ï¼š**
| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜Ž |
|-----|------|------|
| `/mcp/v1/initialize` | POST | MCP åˆå§‹åŒ– |
| `/mcp/v1/tools/list` | POST | åˆ—å‡ºå·¥å…· |
| `/mcp/v1/tools/call` | POST | è°ƒç”¨å·¥å…· |
| `/mcp/v1/sse` | GET | SSE æµå¼è¿žæŽ¥ |

**èµ„æº API ç«¯ç‚¹ï¼ˆéœ€è¦ OAuthï¼‰ï¼š**
| ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜Ž | æ‰€éœ€æƒé™ |
|-----|------|------|---------|
| `/api/user/profile` | GET | èŽ·å–ç”¨æˆ·èµ„æ–™ | read |
| `/api/data` | GET | èŽ·å–æ•°æ®åˆ—è¡¨ | read |
| `/api/data` | POST | åˆ›å»ºæ•°æ® | write |
| `/api/data/:id` | PUT | æ›´æ–°æ•°æ® | write |
| `/api/data/:id` | DELETE | åˆ é™¤æ•°æ® | write |

## ðŸ§ª æµ‹è¯•ç¤ºä¾‹

### 1. æµ‹è¯• OAuth æµç¨‹

```bash
python test_oauth_flow.py
```

### 2. æ‰‹åŠ¨æµ‹è¯• API

```bash
# æ³¨å†Œå®¢æˆ·ç«¯
curl -X POST http://127.0.0.1:5000/oauth/register \
  -H "Content-Type: application/json" \
  -d '{
    "client_name": "Test Client",
    "redirect_uris": ["http://localhost:8080/callback"],
    "grant_types": ["client_credentials"],
    "scope": "read write"
  }'

# èŽ·å–ä»¤ç‰Œ
curl -X POST http://127.0.0.1:5000/oauth/token \
  -d "grant_type=client_credentials" \
  -d "client_id=YOUR_CLIENT_ID" \
  -d "client_secret=YOUR_CLIENT_SECRET" \
  -d "scope=read write"

# è®¿é—®å—ä¿æŠ¤èµ„æº
curl -X GET http://127.0.0.1:5001/api/data \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

### 3. æµ‹è¯• MCP åè®®

```bash
# åˆå§‹åŒ–
curl -X POST http://127.0.0.1:5001/mcp/v1/initialize \
  -H "Content-Type: application/json" \
  -d '{"protocolVersion": "2024-11-05", "capabilities": {}, "clientInfo": {"name": "test", "version": "1.0"}}'

# åˆ—å‡ºå·¥å…·
curl -X POST http://127.0.0.1:5001/mcp/v1/tools/list

# è°ƒç”¨å·¥å…·
curl -X POST http://127.0.0.1:5001/mcp/v1/tools/call \
  -H "Content-Type: application/json" \
  -d '{"name": "oauth_authenticate", "arguments": {}}'
```

## ðŸ—ï¸ ç³»ç»Ÿæž¶æž„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MCP Client          â”‚  (Cursor, Amazon Q CLI, MCP Inspector)
â”‚    (AI Assistant)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Streamable HTTP (SSE)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     MCP Server          â”‚  Port: 5001
â”‚   (mcp_server.py)       â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MCP Protocol    â”‚   â”‚  /mcp/v1/*
â”‚  â”‚  - Initialize    â”‚   â”‚  - å·¥å…·åˆ—è¡¨
â”‚  â”‚  - List Tools    â”‚   â”‚  - å·¥å…·è°ƒç”¨
â”‚  â”‚  - Call Tool     â”‚   â”‚  - SSE æµ
â”‚  â”‚  - SSE Stream    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Resource API    â”‚   â”‚  /api/*
â”‚  â”‚  (OAuth Protected)â”‚  â”‚  - ç”¨æˆ·èµ„æ–™
â”‚  â”‚  - JWT Verify    â”‚   â”‚  - CRUD æ“ä½œ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ OAuth 2.0
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    OAuth Server         â”‚  Port: 5000
â”‚  (oauth_server.py)      â”‚
â”‚                         â”‚
â”‚  - åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ        â”‚
â”‚  - æŽˆæƒç æµç¨‹           â”‚
â”‚  - ä»¤ç‰Œé¢å‘/åˆ·æ–°        â”‚
â”‚  - JWT ç­¾å             â”‚
â”‚  - JWKS å…¬é’¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **OAuth 2.0 æŽˆæƒæœåŠ¡å™¨**ï¼šæ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ (RFC 7591)
- âœ… **MCP æœåŠ¡å™¨ï¼ˆStreamable HTTPï¼‰**ï¼šå®žçŽ° SSE æµå¼ä¼ è¾“åè®®
- âœ… **å—ä¿æŠ¤çš„èµ„æº API**ï¼šé›†æˆåœ¨ MCP æœåŠ¡å™¨ä¸­ï¼Œä½¿ç”¨ JWT éªŒè¯
- âœ… **å¤šç§æŽˆæƒæ¨¡å¼**ï¼šæ”¯æŒ Client Credentialsã€Authorization Codeã€Refresh Token
- âœ… **è‡ªåŠ¨ä»¤ç‰Œåˆ·æ–°**ï¼šè®¿é—®ä»¤ç‰Œè¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°
- âœ… **MCP è§„èŒƒåˆè§„**ï¼šå®žçŽ° Protected Resource Metadata (RFC 9728) å’Œ Authorization Server Metadata (RFC 8414)
- âœ… **æ ‡å‡†å‘çŽ°æœºåˆ¶**ï¼šæ”¯æŒ `.well-known` ç«¯ç‚¹å’Œ WWW-Authenticate header
- âœ… **CORS æ”¯æŒ**ï¼šæ‰€æœ‰ API ç«¯ç‚¹æ”¯æŒè·¨åŸŸè¯·æ±‚

## ðŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

âš ï¸ **è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œä¸é€‚åˆç›´æŽ¥ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒï¼**

**é‡è¦æç¤º**ï¼šæœ¬é¡¹ç›®ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œä½¿ç”¨ HTTP è€Œéž HTTPSã€‚åœ¨ä»£ç ä¸­è®¾ç½®äº† `AUTHLIB_INSECURE_TRANSPORT=1` çŽ¯å¢ƒå˜é‡æ¥ç¦ç”¨ HTTPS æ£€æŸ¥ã€‚**è¿™ä»…ç”¨äºŽå¼€å‘å’Œæ¼”ç¤ºï¼Œç»ä¸èƒ½ç”¨äºŽç”Ÿäº§çŽ¯å¢ƒï¼**

### ç”Ÿäº§çŽ¯å¢ƒå¿…é¡»è€ƒè™‘ï¼š

1. **HTTPS**ï¼š**å¿…é¡»**ä½¿ç”¨ TLS åŠ å¯†æ‰€æœ‰é€šä¿¡ï¼Œç§»é™¤ `AUTHLIB_INSECURE_TRANSPORT` è®¾ç½®
2. **SECRET_KEY**ï¼šä½¿ç”¨å¼ºéšæœºå¯†é’¥ï¼Œä¸è¦ä½¿ç”¨é»˜è®¤å€¼
3. **æŒä¹…åŒ–å­˜å‚¨**ï¼šä½¿ç”¨æ•°æ®åº“ï¼ˆPostgreSQL/MySQLï¼‰è€Œä¸æ˜¯å†…å­˜å­˜å‚¨
4. **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ AWS KMSã€HashiCorp Vaultï¼‰
5. **ç”¨æˆ·è®¤è¯**ï¼šå®žçŽ°çœŸå®žçš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
6. **é€ŸçŽ‡é™åˆ¶**ï¼šé˜²æ­¢ API æ»¥ç”¨
7. **æ—¥å¿—å’Œç›‘æŽ§**ï¼šè®°å½•æ‰€æœ‰å®‰å…¨ç›¸å…³äº‹ä»¶
8. **ä»¤ç‰Œæ’¤é”€**ï¼šå®žçŽ°ä»¤ç‰Œæ’¤é”€æœºåˆ¶
9. **PKCE**ï¼šå¯¹äºŽå…¬å…±å®¢æˆ·ç«¯ä½¿ç”¨ PKCE æ‰©å±•
10. **CORS é™åˆ¶**ï¼šé™åˆ¶å…è®¸çš„æ¥æºåŸŸåï¼Œä¸è¦ä½¿ç”¨ `*`

## ðŸ” æ•…éšœæŽ’æŸ¥

### é—®é¢˜ï¼šæ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5000
lsof -i :5001

# æŸ¥çœ‹å¥åº·çŠ¶æ€
curl http://127.0.0.1:5000/health
curl http://127.0.0.1:5001/health
```

### é—®é¢˜ï¼šToken éªŒè¯å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ OAuth æœåŠ¡å™¨å’Œ MCP æœåŠ¡å™¨éƒ½åœ¨è¿è¡Œ
- æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®ï¼ˆJWT ä¾èµ–æ—¶é—´æˆ³ï¼‰
- ç¡®è®¤ token æœªè¿‡æœŸï¼ˆé»˜è®¤ 3600 ç§’ï¼‰
- å…ˆè°ƒç”¨ `oauth_authenticate` å·¥å…·èŽ·å–æ–°ä»¤ç‰Œ

### é—®é¢˜ï¼šMCP å®¢æˆ·ç«¯æ— æ³•è¿žæŽ¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ MCP é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®ä¿ Python çŽ¯å¢ƒå’Œä¾èµ–å·²æ­£ç¡®å®‰è£…
- æŸ¥çœ‹ MCP å®¢æˆ·ç«¯çš„æ—¥å¿—
- ç¡®è®¤æœåŠ¡å™¨ URL å’Œç«¯å£æ­£ç¡®

## ðŸ“¦ æŠ€æœ¯æ ˆ

- **Python 3.8+**
- **Flask** - Web æ¡†æž¶
- **Flask-CORS** - CORS æ”¯æŒ
- **Authlib** - OAuth 2.0 å®žçŽ°
- **MCP SDK** - Model Context Protocol
- **httpx** - å¼‚æ­¥ HTTP å®¢æˆ·ç«¯
- **cryptography** - åŠ å¯†åº“ï¼ˆJWT ç­¾åï¼‰
- **python-dotenv** - çŽ¯å¢ƒå˜é‡ç®¡ç†

## ðŸ“ é¡¹ç›®ç»“æž„

```
oauth_mcp/
â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ oauth_server.py        # OAuth æŽˆæƒæœåŠ¡å™¨
â”œâ”€â”€ mcp_server.py          # MCP æœåŠ¡å™¨ï¼ˆåŒ…å«èµ„æº APIï¼‰
â”œâ”€â”€ start_servers.py       # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ test_oauth_flow.py     # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”œâ”€â”€ .env.example          # çŽ¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥æ–‡ä»¶
â””â”€â”€ README.md             # æœ¬æ–‡æ¡£
```

## ðŸ“š å‚è€ƒèµ„æº

- [MCP è§„èŒƒ](https://modelcontextprotocol.io/specification/draft/basic/authorization)
- [OAuth 2.0 RFC 6749](https://tools.ietf.org/html/rfc6749)
- [OAuth 2.0 åŠ¨æ€å®¢æˆ·ç«¯æ³¨å†Œ RFC 7591](https://tools.ietf.org/html/rfc7591)
- [Protected Resource Metadata RFC 9728](https://tools.ietf.org/html/rfc9728)
- [Authorization Server Metadata RFC 8414](https://tools.ietf.org/html/rfc8414)

## ðŸ“„ è®¸å¯è¯

MIT License

## ðŸ¤ è´¡çŒ®

æ¬¢è¿Žæäº¤ Issue å’Œ Pull Requestï¼

## ðŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·åˆ›å»º Issueã€‚
